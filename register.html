<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ê²Œì„ ê²°ê³¼ ë“±ë¡</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>

<body class="bg-gray-100 text-gray-800">
  <div class="max-w-2xl mx-auto p-4">
    <h1 class="text-2xl font-bold text-center mb-6">ğŸ® ê²Œì„ ê²°ê³¼ ë“±ë¡</h1>

    <form id="gameForm" class="space-y-4 bg-white shadow p-6 rounded">
      <!-- ë‚ ì§œ -->
      <div>
        <label class="block mb-1 font-semibold">ë‚ ì§œ</label>
        <input type="date" name="date" class="w-full border rounded p-2" required />
      </div>

      <!-- ì‹œë‚˜ë¦¬ì˜¤ -->
      <div>
        <label class="block mb-1 font-semibold">ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ</label>
        <select name="scenario" id="scenario" class="w-full border rounded p-2" required>
          <option value="">â–¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          <option value="íŠ¸ëŸ¬ë¸” ë¸Œë£¨ì‰">íŠ¸ëŸ¬ë¸” ë¸Œë£¨ì‰</option>
          <option value="ì„¹ì¸ ì•¤ë°”ì´ì˜¬ë ›">ì„¹ì¸ ì•¤ë°”ì´ì˜¬ë ›</option>
          <option value="ë°°ë“œë¬¸ë¼ì´ì§•">ë°°ë“œë¬¸ë¼ì´ì§•</option>
          <option value="í¬ì¼“ëª¬ìŠ¤í„°">í¬ì¼“ëª¬ìŠ¤í„°</option>
          <option value="ë°˜ë€ì˜ ê±°ì¹œë°”ë‹¤">ë°˜ë€ì˜ ê±°ì¹œë°”ë‹¤</option>
          <option value="ë¡œë§ˆ">ë¡œë§ˆ</option>
        </select>
      </div>

      <!-- ìŠ¹ë¦¬ íŒ€ -->
      <div>
        <label class="block mb-1 font-semibold">ìŠ¹ë¦¬ íŒ€</label>
        <select name="winningTeam" id="winningTeam" class="w-full border rounded p-2" required>
          <option value="">â–¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          <option value="ì„ íŒ€">ì„ íŒ€ ìŠ¹ë¦¬</option>
          <option value="ì•…íŒ€">ì•…íŒ€ ìŠ¹ë¦¬</option>
        </select>
      </div>

      <!-- í”Œë ˆì´ì–´ ìˆ˜ -->
      <div>
        <label class="block mb-1 font-semibold">í”Œë ˆì´ì–´ ìˆ˜</label>
        <input
          type="number"
          id="playerCount"
          name="playerCount"
          min="1"
          max="20"
          value="5"
          class="w-full border rounded p-2"
          required
        />
      </div>

      <!-- í”Œë ˆì´ì–´ ì…ë ¥ ì˜ì—­ -->
      <div id="playerInputs" class="space-y-4"></div>

      <button
        type="submit"
        class="w-full bg-blue-500 text-white font-semibold py-2 rounded hover:bg-blue-600"
      >
        ì €ì¥í•˜ê¸°
      </button>
    </form>

    <div class="mt-4 text-center">
      <a href="index.html" class="text-blue-500 hover:underline">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>

  <script>
    /* Firebase ê¸°ë³¸ ì„¤ì • */
    const firebaseConfig = {
      apiKey: "AIzaSyCqk52hH5uwWvC8L81l8d6kZgCN2Ynt_Rg",
      authDomain: "blood-on-the-clock-tower-613ce.firebaseapp.com",
      projectId: "blood-on-the-clock-tower-613ce",
      storageBucket: "blood-on-the-clock-tower-613ce.appspot.com",
      messagingSenderId: "619177302977",
      appId: "1:619177302977:web:3b282744ff5b00469e6d40",
      measurementId: "G-W8THYT2M1J",
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    const auth = firebase.auth();

    /* ê´€ë¦¬ì ì´ë©”ì¼ */
    const allowedEmail = "skyhk1202@naver.com";

    /* ìºë¦­í„° ë°ì´í„° */
    const characterData = {
      /* íŠ¸ëŸ¬ë¸” ë¸Œë£¨ì‰ */
      "íŠ¸ëŸ¬ë¸” ë¸Œë£¨ì‰": [
        "ì„¸íƒë¶€", "ì‚¬ì„œ", "ì¡°ì‚¬ê´€", "ìš”ë¦¬ì‚¬", "ê³µê°ëŠ¥ë ¥ì", "ì ìŸì´", "ì¥ì˜ì‚¬", "ìˆ˜ë„ìŠ¹", "ë ˆì´ë¸í‚¤í¼", "ì²˜ë…€",
        "ìŠ¬ë ˆì´ì–´", "êµ°ì¸", "ì‹œì¥", "ì§‘ì‚¬", "ì£¼ì •ë±…ì´", "ì€ë‘”ì", "ì„±ì", "ë…ì‚´ë²”", "ìŠ¤íŒŒì´", "ë¶€ì •í•œì—¬ì",
        "ë‚¨ì‘", "ì„í”„"
      ],
      /* ì„¹ì¸ ì•¤ë°”ì´ì˜¬ë › */
      "ì„¹ì¸ ì•¤ë°”ì´ì˜¬ë ›": [
        "ì‹œê³„ê³µ", "ëª½ìƒê°€", "ë±€ì¡°ë ¨ì‚¬", "ìˆ˜í•™ì", "ê½ƒíŒŒëŠ”ì†Œë…€", "í¬ê³ ê¾¼", "ì˜¤ë¼í´", "í•™ì", "ì¬ë´‰ì‚¬", "ì² í•™ì",
        "ì˜ˆìˆ ê°€", "ì €ê¸€ëŸ¬", "í˜„ì", "ëŒì—°ë³€ì´", "ì—°ì¸", "ì´ë°œì‚¬", "ëª¨ì§€ë¦¬", "ì‚¬ì•…í•œìŒë‘¥ì´", "ë§ˆë…€",
        "ì„¸ë ˆë…¸ë¶€ìŠ¤", "í”¼íŠ¸í•µ", "íŒ¡êµ¬", "ë¹„ê³ ëª¨ë¥´í‹°ìŠ¤", "ë…¸ë‹¤ì‹œ", "ë³¼í…ìŠ¤"
      ],
      /* ë°°ë“œë¬¸ë¼ì´ì§• */
      "ë°°ë“œë¬¸ë¼ì´ì§•": [
        "í• ë¨¸ë‹ˆ", "ì„ ì›", "í•˜ë…€", "í‡´ë§ˆì‚¬", "ì—¬ê´€ì£¼ì¸", "ë„ë°•ê¾¼", "í—˜ë‹´ê¾¼", "ëŒ€ì‹ ", "êµìˆ˜", "ìŒìœ ì‹œì¸",
        "ì°»ì§‘ì—¬ì¸", "í‰í™”ì£¼ì˜ì", "ê´‘ëŒ€", "ë•œì¥ì´", "ë¬¸ì°¨ì¼ë“œ", "ê¹¡íŒ¨", "ë¯¸ì¹˜ê´‘ì´", "ëŒ€ë¶€", "ì•…ë§ˆì˜ëŒ€ë³€ì¸",
        "ì•”ì‚´ì", "ë°°í›„ì¸ë¬¼", "ì¢€ë¶€ìš¸", "í‘¸ì¹´", "ìƒ¤ë°œë¡¯", "í¬"
      ],
      /* í¬ì¼“ëª¬ìŠ¤í„° */
      "í¬ì¼“ëª¬ìŠ¤í„°": [
        "í”¼ì¹´ì¸„", "íŒŒì´ë¦¬", "ê¼¬ë¶€ê¸°", "ì´ìƒí•´ì”¨", "ë¿”ì¶©ì´", "ì¥¬ë²³", "ë¼ì´ì¸„", "ë¦¬ìëª½",
        "ê±°ë¶ì™•", "ì´ìƒí•´ê½ƒ", "í”¼ì£¤", "ë©”íƒ€ëª½", "ì•¼ëˆ", "ê°œêµ´ë‹Œì", "ì•¼ë„ë€", "ì•¼ë„í‚¹",
        "ë”±ì¶©ì´", "ê³ ì˜¤ì“°", "ì‰ì–´í‚¹&ê°¸ë¼ë„ìŠ¤", "ë®¤",
        "ë§ˆììš©", "ì§ˆë»ê¸°", "ë‚˜ì˜¹", "ë¶ë³¼",
        "ë…ì¹¨ë¶•", "íŒ¬í…€", "ë®¤ì¸ ", "ë¡œì¼“ë‹¨"
      ],
      /* ë°˜ë€ì˜ ê±°ì¹œë°”ë‹¤ */
      "ë°˜ë€ì˜ ê±°ì¹œë°”ë‹¤": [
        "ë…¸ë ¨í•œ ì„ ì›", "í•­í•´ì", "ê°‘íŒì¥", "ê°‘íŒì›", "ì„ ì¥", "ë²„ì¼€ë‹ˆì–´", "í’‹ë‚´ê¸°ì„ ì›",
        "ì—¬ê¸‰", "ì‚¬ëµì„ ", "1ë“±í•­í•´ì‚¬", "í™”ì•½ìš´ë°˜ìˆ˜", "í•´ì ì„ ", "ì†Œë¼ê²Œ",
        "ë”°ê°œë¹„", "ì¸ì–´", "ì½”ì£¼ë¶€", "ë°€í•­ì",
        "ì‹ ë¹„ì—¬ì‚¬ì œ", "ë°”ë‹¤ì •ë ¹", "ì–¸ë°ë“œí•´ì ", "ì‚´ì í¬ì‹ì",
        "í¬ë¼ì¼„", "ì¹¼ë¦½ì†Œ", "ë£¨ì‚´ì¹´", "ìš°ë¯¸ë³´ì¦ˆ"
      ],
      /* ë¡œë§ˆ */
      "ë¡œë§ˆ": [
        "ì¡°ê°ê°€", "ë² ìŠ¤íƒ€ì˜ë¬´ë…€", "ì˜ì‚¬", "êµ°ë‹¨ë³‘", "ë‚˜íŒ”ìˆ˜", "ì¥ì˜ì‚¬", "êµ°ë‹¨ê¸°ìˆ˜",
        "ë°±ì¸ëŒ€ì¥", "ìƒì¸", "ê²€íˆ¬ì‚¬", "ë°°ìš°", "ëŒ€ì¥ì¥ì´", "í•™ì",
        "ìŒë‘¥ì´", "ìŠ¤íŒŒë¥´íƒ€ì¿ ìŠ¤", "ì™€ì¸ì œì¡°ì", "ë¶ˆê¸¸í•œì§•ì¡°",
        "ìš”ë¶€", "ê¸€ë¦¬ì½˜", "ë‚´ì¥ì ìˆ ê°€", "ì¡°ì ê´€",
        "í´ë ˆì˜¤íŒŒíŠ¸ë¼", "í•œë‹ˆë°œ", "í¬ë¼ìˆ˜ìŠ¤", "ì¹´ì´ì‚¬ë¥´"
      ]
    };

    /* ê¶Œí•œ ì²´í¬: íŒì—… ì—†ì´ ì¦‰ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ */
    auth.onAuthStateChanged((user) => {
      if (!user || user.email !== allowedEmail) {
        window.location.replace("login.html");
      }
    });

    /* í”Œë ˆì´ì–´ ì…ë ¥ í•„ë“œ ìƒì„± í•¨ìˆ˜ */
    function updatePlayerInputs(count) {
      const scenario = document.getElementById("scenario").value;
      const characters = characterData[scenario] || [];
      const container = document.getElementById("playerInputs");
      container.innerHTML = "";

      for (let i = 0; i < count; i++) {
        const div = document.createElement("div");
        div.innerHTML = `
          <div class="p-3 bg-gray-50 rounded shadow">
            <h3 class="font-semibold mb-2">í”Œë ˆì´ì–´ ${i + 1}</h3>
            <input type="text" name="player${i}_name" placeholder="ì´ë¦„" class="w-full border rounded p-2 mb-2" required>
            <select name="player${i}_character" class="w-full border rounded p-2" required>
              <option value="">ìºë¦­í„° ì„ íƒ</option>
              ${characters.map(c => `<option value="${c}">${c}</option>`).join("")}
            </select>
          </div>
        `;
        container.appendChild(div);
      }
    }

    /* ì´ë²¤íŠ¸ ë°”ì¸ë”© */
    document.getElementById("playerCount").addEventListener("change", () => {
      updatePlayerInputs(parseInt(document.getElementById("playerCount").value, 10));
    });

    document.getElementById("scenario").addEventListener("change", () => {
      updatePlayerInputs(parseInt(document.getElementById("playerCount").value, 10));
    });

    /* í¼ ì œì¶œ */
    document.getElementById("gameForm").addEventListener("submit", async (e) => {
      e.preventDefault();

      const date = e.target.date.value;
      const scenario = e.target.scenario.value;
      const winningTeam = e.target.winningTeam.value;
      const playerCount = parseInt(e.target.playerCount.value, 10);
      const players = [];

      for (let i = 0; i < playerCount; i++) {
        players.push({
          name: e.target[`player${i}_name`].value,
          character: e.target[`player${i}_character`].value
        });
      }

      await db.collection("games").add({
        date,
        scenario,
        winningTeam,
        players,
        timestamp: new Date()
      });

      alert("ë°ì´í„°ê°€ Firebaseì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
      e.target.reset();
      updatePlayerInputs(5);
    });

    /* í˜ì´ì§€ ì²« ë¡œë“œ ì‹œ ê¸°ë³¸ 5ì¸ ì…ë ¥ í‘œì‹œ */
    updatePlayerInputs(5);
  </script>
</body>
</html>
