<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì „ì²´ í†µê³„</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-5xl mx-auto p-6">
    <h1 class="text-2xl font-bold text-center mb-6">ğŸ“Š ì „ì²´ í†µê³„</h1>

    <div class="text-center mb-4">
      <label class="font-semibold mr-2">ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ:</label>
      <select id="scenarioFilter" class="border p-2 rounded">
        <option value="all">ì „ì²´</option>
        <option value="íŠ¸ëŸ¬ë¸” ë¸Œë£¨ì‰">íŠ¸ëŸ¬ë¸” ë¸Œë£¨ì‰</option>
        <option value="ì„¹ì¸ ì•¤ë°”ì´ì˜¬ë ›">ì„¹ì¸ ì•¤ë°”ì´ì˜¬ë ›</option>
        <option value="ë°°ë“œë¬¸ë¼ì´ì§•">ë°°ë“œë¬¸ë¼ì´ì§•</option>
        <option value="í¬ì¼“ëª¬ìŠ¤í„°">í¬ì¼“ëª¬ìŠ¤í„°</option>
        <option value="ë°˜ë€ì˜ ê±°ì¹œë°”ë‹¤">ë°˜ë€ì˜ ê±°ì¹œë°”ë‹¤</option>
        <option value="ë¡œë§ˆ">ë¡œë§ˆ</option>
      </select>
    </div>

    <div id="summary" class="space-y-4 text-center"></div>
    <div class="mt-8 text-center">
      <a href="index.html" class="text-blue-500 hover:underline">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCqk52hH5uwWvC8L81l8d6kZgCN2Ynt_Rg",
      authDomain: "blood-on-the-clock-tower-613ce.firebaseapp.com",
      projectId: "blood-on-the-clock-tower-613ce",
      storageBucket: "blood-on-the-clock-tower-613ce.firebasestorage.app",
      messagingSenderId: "619177302977",
      appId: "1:619177302977:web:3b282744ff5b00469e6d40"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const evilCharacters = ["ì„í”„", "ë…ì‚´ë²”", "ìŠ¤íŒŒì´", "ë¶€ì •í•œì—¬ì", "ë‚¨ì‘", "íŒ¡êµ¬", "ë¹„ê³ ëª¨ë¥´í‹°ìŠ¤", "ë…¸ë‹¤ì‹œ", "ë³¼í…ìŠ¤", "ì¢€ë¶€ìš¸", "í‘¸ì¹´", "ìƒ¤ë°œë¡¯", "í¬", "í¬ë¼ì¼„", "ì¹¼ë¦½ì†Œ", "ë£¨ì‚´ì¹´", "ìš°ë¯¸ë³´ì¦ˆ", "í´ë ˆì˜¤íŒŒíŠ¸ë¼", "í•œë‹ˆë°œ", "í¬ë¼ìˆ˜ìŠ¤", "ì¹´ì´ì‚¬ë¥´", "ë¡œì¼“ë‹¨", "íŒ¬í…€", "ë…ì¹¨ë¶•"];
    const outsiderCharacters = ["ì§‘ì‚¬", "ì£¼ì •ë±…ì´", "ì€ë‘”ì", "ì„±ì", "ëŒì—°ë³€ì´", "ì—°ì¸", "ì´ë°œì‚¬", "ëª¨ì§€ë¦¬", "ë•œì¥ì´", "ë¬¸ì°¨ì¼ë“œ", "ê¹¡íŒ¨", "ë¯¸ì¹˜ê´‘ì´", "ë”°ê°œë¹„", "ì¸ì–´", "ì½”ì£¼ë¶€", "ë°€í•­ì", "ìŒë‘¥ì´", "ìŠ¤íŒŒë¥´íƒ€ì¿ ìŠ¤", "ì™€ì¸ì œì¡°ì", "ë¶ˆê¸¸í•œì§•ì¡°", "ë”±ì¶©ì´", "ê³ ì˜¤ì“°", "ì‰ì–´í‚¹&ê°¸ë¼ë„ìŠ¤", "ë®¤"];
    const minionCharacters = ["ë…ì‚´ë²”", "ìŠ¤íŒŒì´", "ë¶€ì •í•œì—¬ì", "ë‚¨ì‘", "ì‚¬ì•…í•œìŒë‘¥ì´", "ë§ˆë…€", "ì„¸ë ˆë…¸ë¶€ìŠ¤", "í”¼íŠ¸í•µ", "ëŒ€ë¶€", "ì•…ë§ˆì˜ëŒ€ë³€ì¸", "ì•”ì‚´ì", "ë°°í›„ì¸ë¬¼", "ì‹ ë¹„ì—¬ì‚¬ì œ", "ë°”ë‹¤ì •ë ¹", "ì–¸ë°ë“œí•´ì ", "ì‚´ì í¬ì‹ì", "ìš”ë¶€", "ê¸€ë¦¬ì½˜", "ë‚´ì¥ì ìˆ ê°€", "ì¡°ì ê´€", "ë§ˆììš©", "ì§ˆë»ê¸°", "ë‚˜ì˜¹", "ë¶ë³¼"];
    const townCharacters = ["ì„¸íƒë¶€", "ì‚¬ì„œ", "ì¡°ì‚¬ê´€", "ìš”ë¦¬ì‚¬", "ê³µê°ëŠ¥ë ¥ì", "ì ìŸì´", "ì¥ì˜ì‚¬", "ìˆ˜ë„ìŠ¹", "ë ˆì´ë¸í‚¤í¼", "ì²˜ë…€", "ìŠ¬ë ˆì´ì–´", "êµ°ì¸", "ì‹œì¥", "ì‹œê³„ê³µ", "ëª½ìƒê°€", "ë±€ì¡°ë ¨ì‚¬", "ìˆ˜í•™ì", "ê½ƒíŒŒëŠ”ì†Œë…€", "í¬ê³ ê¾¼", "ì˜¤ë¼í´", "í•™ì", "ì¬ë´‰ì‚¬", "ì² í•™ì", "ì˜ˆìˆ ê°€", "ì €ê¸€ëŸ¬", "í˜„ì", "í• ë¨¸ë‹ˆ", "ì„ ì›", "í•˜ë…€", "í‡´ë§ˆì‚¬", "ì—¬ê´€ì£¼ì¸", "ë„ë°•ê¾¼", "í—˜ë‹´ê¾¼", "ëŒ€ì‹ ", "êµìˆ˜", "ìŒìœ ì‹œì¸", "ì°»ì§‘ì—¬ì¸", "í‰í™”ì£¼ì˜ì", "ê´‘ëŒ€", "ë…¸ë ¨í•œ ì„ ì›", "í•­í•´ì", "ê°‘íŒì¥", "ê°‘íŒì›", "ì„ ì¥", "ë²„ì¼€ë‹ˆì–´", "í’‹ë‚´ê¸°ì„ ì›", "ì—¬ê¸‰", "ì‚¬ëµì„ ", "1ë“±í•­í•´ì‚¬", "í™”ì•½ìš´ë°˜ìˆ˜", "í•´ì ì„ ", "ì†Œë¼ê²Œ", "ì¡°ê°ê°€", "ë² ìŠ¤íƒ€ì˜ë¬´ë…€", "ì˜ì‚¬", "êµ°ë‹¨ë³‘", "ë‚˜íŒ”ìˆ˜", "ì¥ì˜ì‚¬", "êµ°ë‹¨ê¸°ìˆ˜", "ë°±ì¸ëŒ€ì¥", "ìƒì¸", "ê²€íˆ¬ì‚¬", "ë°°ìš°", "ëŒ€ì¥ì¥ì´", "í•™ì", "í”¼ì¹´ì¸„", "íŒŒì´ë¦¬", "ê¼¬ë¶€ê¸°", "ì´ìƒí•´ì”¨", "ë¿”ì¶©ì´", "ì¥¬ë²³", "ë¼ì´ì¸„", "ë¦¬ìëª½", "ê±°ë¶ì™•", "ì´ìƒí•´ê½ƒ", "í”¼ì£¤", "ë©”íƒ€ëª½", "ì•¼ëˆ", "ê°œêµ´ë‹Œì", "ì•¼ë„ë€", "ì•¼ë„í‚¹"];

    function getRoleIcon(character) {
      if (evilCharacters.includes(character)) return "ğŸ˜ˆ";
      if (minionCharacters.includes(character)) return "ğŸ§Ÿ";
      if (outsiderCharacters.includes(character)) return "ğŸ¤¡";
      if (townCharacters.includes(character)) return "ğŸ§‘â€ğŸŒ¾";
      return "â“";
    }

    async function fetchStats() {
      const scenario = document.getElementById("scenarioFilter").value;
      const snapshot = await db.collection("games").get();
      const allGames = snapshot.docs.map(doc => doc.data());

      let filteredGames = scenario === "all" ? allGames : allGames.filter(g => g.scenario === scenario);
      let teamWinCounter = { ì„ : 0, ì•…: 0 };
      let charWins = {};

      filteredGames.forEach(game => {
        let counted = {};
        game.players.forEach(p => {
          const char = p.character || "ì•Œ ìˆ˜ ì—†ìŒ";
          const win = p.win === "ìŠ¹ë¦¬";
          if (!charWins[char]) charWins[char] = { win: 0, total: 0 };
          charWins[char].total++;
          if (win) charWins[char].win++;

          if (win && !counted[char]) {
            if (townCharacters.includes(char)) teamWinCounter["ì„ "]++;
            else if (evilCharacters.includes(char)) teamWinCounter["ì•…"]++;
            counted[char] = true;
          }
        });
      });

      const summary = document.getElementById("summary");
      summary.innerHTML = `
        <p>ì „ì²´ ê²Œì„ ìˆ˜: <strong>${filteredGames.length}</strong></p>
        <p>ğŸ˜‡ ì„ íŒ€ ìŠ¹ë¦¬: ${teamWinCounter["ì„ "]}</p>
        <p>ğŸ˜ˆ ì•…íŒ€ ìŠ¹ë¦¬: ${teamWinCounter["ì•…"]}</p>
        <hr class="my-4">
        <h2 class="text-xl font-bold">ìºë¦­í„°ë³„ ìŠ¹ë¥ </h2>
        <ul class="text-left inline-block">
          ${Object.entries(charWins)
            .sort((a, b) => b[1].total - a[1].total)
            .map(([char, data]) => {
              const rate = ((data.win / data.total) * 100).toFixed(1);
              const icon = getRoleIcon(char);
              return `<li>${icon} ${char}: ${data.win}ìŠ¹ / ${data.total}ì „ (${rate}%)</li>`;
            }).join("")}
        </ul>
      `;
    }

    document.getElementById("scenarioFilter").addEventListener("change", fetchStats);
    window.onload = fetchStats;
  </script>
</body>
</html>
