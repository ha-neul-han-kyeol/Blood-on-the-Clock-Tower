
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ì „ì²´ í†µê³„</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-5xl mx-auto p-8">
    <h1 class="text-4xl font-extrabold text-center mb-8">ğŸ“Š ì „ì²´ í†µê³„</h1>

    <div class="flex justify-center items-center gap-4 mb-6">
      <label class="text-2xl font-semibold">ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ:</label>
      <select id="scenarioFilter" class="border p-3 rounded text-2xl">
        <option value="all">ì „ì²´</option>
        <option value="íŠ¸ëŸ¬ë¸” ë¸Œë£¨ì‰">íŠ¸ëŸ¬ë¸” ë¸Œë£¨ì‰</option>
        <option value="ì„¹ì¸ ì•¤ë°”ì´ì˜¬ë ›">ì„¹ì¸ ì•¤ë°”ì´ì˜¬ë ›</option>
        <option value="ë°°ë“œë¬¸ë¼ì´ì§•">ë°°ë“œë¬¸ë¼ì´ì§•</option>
        <option value="í¬ì¼“ëª¬ìŠ¤í„°">í¬ì¼“ëª¬ìŠ¤í„°</option>
        <option value="ë°˜ë€ì˜ ê±°ì¹œë°”ë‹¤">ë°˜ë€ì˜ ê±°ì¹œë°”ë‹¤</option>
        <option value="ë¡œë§ˆ">ë¡œë§ˆ</option>
      </select>
    </div>

    <div id="summary" class="space-y-6 text-center text-2xl"></div>

    <div class="mt-10 text-center">
      <a href="index.html" class="text-blue-500 hover:underline text-2xl">â† í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
    </div>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCqk52hH5uwWvC8L81l8d6kZgCN2Ynt_Rg",
  authDomain: "blood-on-the-clock-tower-613ce.firebaseapp.com",
  projectId: "blood-on-the-clock-tower-613ce",
  storageBucket: "blood-on-the-clock-tower-613ce.firebasestorage.app",
  messagingSenderId: "619177302977",
  appId: "1:619177302977:web:3b282744ff5b00469e6d40"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

const demons=["ì„í”„","íŒ¡êµ¬","ë¹„ê³ ëª¨ë¥´í‹°ìŠ¤","ë…¸ë‹¤ì‹œ","ë³¼í…ìŠ¤","ì¢€ë¶€ìš¸","í‘¸ì¹´","ìƒ¤ë°œë¡¯","í¬"];
const minions=["ë…ì‚´ë²”","ìŠ¤íŒŒì´","ë¶€ì •í•œì—¬ì","ë‚¨ì‘","ì‚¬ì•…í•œìŒë‘¥ì´","ë§ˆë…€","ì„¸ë ˆë…¸ë¶€ìŠ¤","í”¼íŠ¸í•µ"];
const outsiders=["ì§‘ì‚¬","ì£¼ì •ë±…ì´","ì€ë‘”ì","ì„±ì","ëŒì—°ë³€ì´","ì—°ì¸","ì´ë°œì‚¬","ëª¨ì§€ë¦¬"];
function getIcon(char){
  if(demons.includes(char)) return "ğŸ˜ˆ";
  if(minions.includes(char)) return "ğŸ§Ÿ";
  if(outsiders.includes(char)) return "ğŸ¤¡";
  return "ğŸ§‘â€ğŸŒ¾";
}

function sortEntries(charWins){
  return Object.entries(charWins).sort((a,b)=>{
    const ar=a[1].win/a[1].total, br=b[1].win/b[1].total;
    if(br!==ar) return br-ar;
    if(b[1].win!==a[1].win) return b[1].win-a[1].win;
    if(b[1].total!==a[1].total) return b[1].total-a[1].total;
    return a[0].localeCompare(b[0]);
  });
}

async function build(){
  const scenario=document.getElementById("scenarioFilter").value;
  const snap=await db.collection("games").get();
  const games=snap.docs.map(d=>d.data()).filter(g=>scenario==="all"||g.scenario===scenario);

  let charWins={}, teamWin={ì„ :0,ì•…:0};

  games.forEach(g=>{
    let good=false,evil=false;
    g.players.forEach(p=>{
      const c=p.character, win=p.win==="ìŠ¹ë¦¬";
      if(!charWins[c]) charWins[c]={win:0,total:0};
      charWins[c].total++;
      if(win) charWins[c].win++;
      if(win){
        if(demons.includes(c)||minions.includes(c)) evil=true; else good=true;
      }
    });
    if(good&&!evil) teamWin["ì„ "]++;
    if(evil&&!good) teamWin["ì•…"]++;
  });

  const summary=document.getElementById("summary");
  summary.innerHTML="";
  summary.appendChild(createP(`ì „ì²´ ê²Œì„ ìˆ˜: <strong>${games.length}</strong>`));
  summary.appendChild(createP(`ğŸ§‘â€ğŸŒ¾ <strong>ì„ íŒ€ ìŠ¹ë¦¬:</strong> ${teamWin["ì„ "]}`));
  summary.appendChild(createP(`ğŸ˜ˆ <strong>ì•…íŒ€ ìŠ¹ë¦¬:</strong> ${teamWin["ì•…"]}`));

  summary.appendChild(hr());
  const h=document.createElement("h3");h.className="text-3xl font-bold";h.innerText="ìºë¦­í„°ë³„ ìŠ¹ë¥ ";
  summary.appendChild(h);

  const list=document.createElement("ul");list.className="text-left inline-block";
  sortEntries(charWins).forEach(([c,d],i)=>{
    const pct=((d.win/d.total)*100).toFixed(1);
    const li=document.createElement("li");
    li.innerHTML=`<strong>${i+1}ìœ„.</strong> ${getIcon(c)} <strong>${c}</strong>: ${d.win}ìŠ¹ / ${d.total}ì „ (${pct}%)`;
    list.appendChild(li);
  });
  summary.appendChild(list);
}
function createP(html){const p=document.createElement("p");p.innerHTML=html;return p;}
function hr(){const h=document.createElement("hr");h.className="my-6";return h;}

document.getElementById("scenarioFilter").addEventListener("change",build);
window.onload=build;
</script>
</body>
</html>
